mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
) %>%
count(enrolled, .drop = FALSE) %>%
filter(enrolled == "enrolled")
df %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
)
df <- mailer_cost %>%
mutate(city = stringr::str_trim(city)) %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
# filter(ps_proj_eligible %in% project_select) %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
)  %>%
group_by(zip_id, location = city, volume)
scrn <- df %>%
filter(screened == "screened") %>%
count(name = "screenings") %>%
ungroup() %>%
select(zip_id, screenings)
ps <- df %>%
count(name = "prescreens")
enrolled <- df %>%
count(name = "enrolled")
full_join(ps, scrn, by = "zip_id") %>%
full_join(enrolled, by = "zip_id") %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = "zip_id") %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume") %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
246
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
enrolled <- df %>%
count(enrolled, name = "enrolled")
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
scrn <- df %>%
filter(screened == "screened") %>%
count(name = "screenings") %>%
ungroup() %>%
select(zip_id, screenings)
ps <- df %>%
count(name = "prescreens")
enrolled <- df %>%
count(enrolled, name = "enrolled")
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
scrn <- df %>%
filter(screened == "screened") %>%
count(name = "screenings") %>%
ungroup() %>%
select(zip_id, screenings)
ps <- df %>%
count(name = "prescreens")
enrolled <- df %>%
filter(enrolled == "enrolled") %>%
count(enrolled, name = "enrolled")
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
full_join(ps, scrn, by = "zip_id")
t <- full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
t[is.na(t)] <- 0
t
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
tidyr::replace_na(0) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
full_join(ps, scrn, by = "zip_id") %>%
left_join(enrolled, by = c("zip_id", "location", "volume")) %>%
rename("zip" = zip_id) %>%
mutate(zip = ifelse(nchar(zip) == 4, paste("0", zip, sep = ""), zip)) %>%
mutate(across(everything(), .fns = ~tidyr::replace_na(., 0))) %>%
datatable(rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
))
runApp()
runApp()
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
) %>%
count(enrolled, .drop = FALSE) %>%
filter(enrolled == "enrolled")
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
)
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == direct_mail) %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
) %>%
count()
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
) %>%
count()
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
)
df %>% filter(screened == "screened") %>% count()
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
)
df %>% count(name = "prescreens")
df %>% filter(screened == "screened") %>% count()
ps <- df %>% count(name = "prescreens")
screened <- df %>% filter(screened == "screened") %>% count(name = "screened")
df %>% filter(enrolled == "enrolled") %>% count(name = "enrolled")
df %>% summarize(sum(volume))
df %>% summarize(sum(c(volume, cost)))
df %>% summarize(sum(volume, cost))
df %>% select(volume, cost) %>% summarize(sum)
df %>% select(volume, cost) %>% summarize(sum())
df %>% select(volume, cost)
df %>% select(volume, cost) %>% distinct() %>% summarize(sum())
df %>% select(volume, cost) %>% distinct()
df %>% select(volume, cost) %>% distinct() %>% summarize(across(everything(), sum()))
df %>% select(volume, cost) %>% distinct() %>% summarize(across(everything(), sum))
totals <- df %>% select(volume, cost) %>%
distinct() %>%
summarize(across(everything(), sum))
cbind(totals, ps, screened, enrolled)
totals <- df %>% select(volume, cost) %>%
distinct() %>%
summarize(across(everything(), sum))
ps <- df %>% count(name = "prescreens")
screened <- df %>% filter(screened == "screened") %>% count(name = "screened")
enrolled <- df %>% filter(enrolled == "enrolled") %>% count(name = "enrolled")
cbind(totals, ps, screened, enrolled)
mailer_overall <- function(ps_location, mailer_cost) {
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
mutate(
enrolled = ifelse(sl_status %in% c("Complete", "In Progress"), "enrolled", "not_enrolled"),
enrolled = factor(enrolled, levels = c("enrolled", "not_enrolled"))
)
ps <- df %>% count(name = "prescreens")
screened <- df %>% filter(screened == "screened") %>% count(name = "screened")
enrolled <- df %>% filter(enrolled == "enrolled") %>% count(name = "enrolled")
totals <- df %>% select(volume, cost) %>%
distinct() %>%
summarize(across(everything(), sum))
cbind(totals, ps, screened, enrolled)
}
ps_location %>%
filter(
ps_proj_eligible %in% proj(),
source %in% sources(),
recruit_date >= date_range()[[1]],
recruit_date <= date_range()[[2]]
)
runApp()
runApp()
cbind(totals, ps, screened, enrolled) %>%
mutate(colume = as.integer)
cbind(totals, ps, screened, enrolled) %>%
mutate(volume = as.integer(volume))
cbind(totals, ps, screened, enrolled) %>%
mutate(volume = as.integer(volume)) %>%
datatable(
rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
),
formatCurrency(columns = "cost")
)
cbind(totals, ps, screened, enrolled) %>%
mutate(volume = as.integer(volume)) %>%
datatable(
rownames = FALSE,
options = list(
columnDefs = list(list(className = 'dt-center', targets = "_all"))
)
) %>%
formatCurrency(columns = "cost")
runApp()
runApp()
runApp()
runApp()
runApp()
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail")
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
select(recruit_date)
mailer_response <- function(ps_location, mailer_cost) {
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
select(recruit_date, zip = zip_id)
2457
o-0w47
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
select(recruit_date, zip = zip_id)
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
select(recruit_date, location = city, zip = zip_id)
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, location = city, zip = zip_id)
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, location = city, zip = zip_id) %>%
count()
View(df)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth()
mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, date_sent, location = city, zip = zip_id) %>%
count()
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, date_sent, location = city, zip = zip_id) %>%
count()
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth()
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth() +
facet_wrap(~ location)
View(df)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth() +
facet_wrap(~ location, free.y = TRUE)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth() +
facet_wrap(~ location, scales = "free_y")
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_line() +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth(formula = "loess") +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth(method = "loess") +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_smooth(method = "lm") +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(aes(x = as.Date(date_sent))) +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(aes(xintercept = as.Date(date_sent))) +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent), y = max(y) - 10, label = date_sent)) +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent), y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent), y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location) +
labs(
x = "",
y = "Prescreens"
)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent), y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent) - 7, y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent) - 7),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent) - 7, y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = as.Date(date_sent)),
linetype = "dashed") +
geom_label(aes(x = as.Date(date_sent), y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, date_sent, location = city, zip = zip_id) %>%
count() %>%
mutate(date_recode = as.Date(date_sent) = 7)
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, date_sent, location = city, zip = zip_id) %>%
count() %>%
mutate(date_recode = as.Date(date_sent) - 7)
View(df)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = date_recode),
linetype = "dashed") +
geom_label(aes(x = date_recode, y = max(n) - 2, label = date_sent)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = date_recode),
linetype = "dashed") +
geom_label(aes(x = date_recode, y = max(n) - 2, label = date_recode)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
date_pad <- 14
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, date_sent, location = city, zip = zip_id) %>%
count() %>%
mutate(date_recode = as.Date(date_sent) - date_pad)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = date_recode),
linetype = "dashed") +
geom_label(aes(x = date_recode, y = max(n) - 2, label = date_recode)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
runApp()
date_pad <- 14
date_pad = 14
mailer_response(ps_location, mailer_cost)
mailer_response <- function(ps_location, mailer_cost) {
# we don't know exactly when the mailers are sent, we only get
# an "order finalized" date
date_pad <- 14
df <- mailer_cost %>%
left_join(ps_location, by = "zip_id") %>%
filter(source == "direct_mail") %>%
group_by(recruit_date, date_sent, location = city, zip = zip_id) %>%
count() %>%
mutate(date_recode = as.Date(date_sent) - date_pad)
ggplot(df, aes(x = as.Date(recruit_date), y = n)) +
geom_point() +
geom_vline(
aes(xintercept = date_recode),
linetype = "dashed") +
geom_label(aes(x = date_recode, y = max(n) - 2, label = date_recode)) +
facet_wrap(~ location) +
theme(axis.text.x = element_text(angle = 45, hjust= 1)) +
labs(
x = "",
y = "Prescreens"
)
}
mailer_response(ps_location, mailer_cost)
runApp()
runApp()
mailer_cost <- read.csv("./data/mailer_cost.csv")
View(mailer_cost)
runApp()
runApp()
View(mailer_cost)
runApp()
