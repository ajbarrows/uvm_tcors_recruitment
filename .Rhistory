aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ps_proj_list <- c("Project 1", "Project 1 and Project 3", "Project 2", "Project 3")
rct_flow(ps_location, ps_proj_list)
rct_flow <- function(ps_location, ps_proj_list) {
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
}
rct_flow(ps_location, ps_proj_list)
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum),
size = n),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
df
df %>% filter(source == "instagram")
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum),
size = -n),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum),
size = n),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum),
size = n * 10),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count() %>%
ungroup()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count() %>%
ungroup()
if (filter_low_n) {
df <- df %>% filter(n > 5)
}
rct_flow <- function(ps_location, ps_proj_list, filter_low_n) {
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count() %>%
ungroup()
if (filter_low_n) {
df <- df %>% filter(n > 5)
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
}
filter_low_n <- TRUE
rct_flow(ps_location, ps_proj_list, filter_low_n)
rct_flow <- function(ps_location, ps_proj_list, filter_low_n) {
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count() %>%
ungroup()
if (filter_low_n) {
df <- df %>% filter(n > 3)
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
}
rct_flow(ps_location, ps_proj_list, filter_low_n)
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count() %>%
ungroup()
View(df)
df <- df %>% filter(n > 3)
View(df)
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count() %>%
ungroup()
df <- df %>%
group_by(source) %>%
filter(n > 3)
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
df
df <- df %>%
filter(n > 3)
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
if (filter_low_n) {
df <- df %>%
filter(n > 1)
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
if (filter_low_n) {
df <- df %>%
filter(n > 5)
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
if (filter_low_n) {
df <- df %>%
group_by(source) %>%
filter(n > 5)
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
View(df)
df %>%
group_by(source) %>%
filter(sum(source) > 5)
df %>%
group_by(source) %>%
mutate(source_sum = sum(source)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
df %>%
group_by(source) %>%
mutate(source_sum = sum(n)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
df %>%
group_by(source) %>%
mutate(source_sum = sum(n)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
if (filter_low_n) {
df <- df %>%
group_by(source) %>%
mutate(source_sum = sum(n)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
filter_screened <- TRUE
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
if (filter_low_n) {
df <- df %>%
group_by(source) %>%
mutate(source_sum = sum(n)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
} else if (filter_screened) {
df <- df %>%
filter(screened == "screened")
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete) %>%
count()
if (filter_low_n) {
df <- df %>%
group_by(source) %>%
mutate(source_sum = sum(n)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
}
if (filter_screened) {
df <- df %>%
filter(screened == "screened")
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = rand_proj)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = source)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = ps_proj_eligible)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = complete)) +
geom_alluvium(aes(fill = randomized)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = sl_status)) +
geom_alluvium(aes(fill = randomized)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df <- ps_location %>%
filter(ps_proj_eligible %in% ps_proj_list) %>%
group_by(source, ps_proj_eligible, screened,
rand_proj, randomized, complete, sl_status) %>%
count()
if (filter_low_n) {
df <- df %>%
group_by(source) %>%
mutate(source_sum = sum(n)) %>%
filter(source_sum > 5) %>%
select(-source_sum)
}
if (filter_screened) {
df <- df %>%
filter(screened == "screened")
}
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = sl_status)) +
geom_alluvium(aes(fill = randomized)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
ggplot(df, aes(y = n,
axis1 = source,
axis2 = ps_proj_eligible,
axis3 = rand_proj,
axis4 = sl_status)) +
geom_alluvium(aes(fill = sl_status)) +
geom_stratum(width = 1/4, color = "black", alpha = .5) +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
alpha = .75) +
theme(axis.ticks.x = element_blank(),
axis.text.x = element_blank(),
axis.line.x = element_blank(),
legend.position = "top") +
labs(fill = "") +
scale_fill_viridis_d()
df
