redcap_id, recruit_date, source, recruit_int_summ,
ps_proj_eligible = elig_project_4
) %>%
mutate(
screened = NA,
sl_status = NA,
randomized = NA,
complete = NA,
rand_proj = NA
)
download_ps_p4 <- function() {
# Project 4's REDCap project is structured differently,
# which requires a different approach.
rcon_ps_p4 <- build_rcon("rc_prescreen_p4")
# rcon_id_p4 <- build_rcon("rd_id_info_p4")
ps_fields <- c(
"redcap_id", "recruit_identinfo_id", "recruit_date",
"recruit_int_summ", "recruit_1",
"recruit_3", "recruit_4", "recruit_4a", "recruit_5",
"recruit_6", "recruit_7", "recruit_7a", "recruit_8",
"recruit_9", "recruit_10", "recruit_11", "recruit_12",
"recruit_13", "recruit_14", "recruit_15"
)
df_ps <- download_ps(rcon_ps_p4, fields = ps_fields)
df_ps %>%
mutate(elig_project_4 = ifelse(
recruit_3 == 1 &
(recruit_4 == 0 |
(recruit_4 == 1 & recruit_4a < 10)) &
recruit_5 == 0 &
recruit_6 == 0 &
recruit_7a == 0 &
(recruit_8 == 0 | recruit_8 == 7777) &
recruit_9 == 0 &
recruit_10 == 0 &
(recruit_11 > 17 & recruit_11 < 45) &
recruit_12 == 1 &
recruit_13 == 1 &
recruit_14 < 26 &
recruit_15 %in% 1:4,
"Project 4", "ineligible"
),
recruit_int_summ = recode(
as.character(recruit_int_summ),
"1" = "screening_scheduled",
"2" = "waiting_list",
"3" = "screening_declined",
"4" = "ineligible",
"5" = "lost_contact",
.default = NA_character_
)
) %>%
select(
redcap_id, recruit_identinfo_id, recruit_date,
recruit_int_summ, elig_project_4, starts_with("recruit_1___")
)
}
p4_data <- download_ps_p4()
p4_data <- clean_ps(p4_data, start_date = as.Date("2019-01-01"))
p4 <- gather_p4(p4_data)
p4 <- recode_buildclinical(p4)
plot_p4 <- p4 %>%
select(
redcap_id, recruit_date, source, recruit_int_summ,
ps_proj_eligible = elig_project_4
) %>%
mutate(
screened = NA,
sl_status = NA,
randomized = NA,
complete = NA,
rand_proj = NA
)
View(plot_p4)
write.csv(plot_df, "./out/plot_df.csv", row.names = FALSE)
plot_df <- read.csv("./out/plot_df.csv")
runApp()
runApp()
runApp()
View(plot_df)
runApp()
View(plot_df)
ps_proj_list
ps_proj_list <- c(ps_proj_list, "Project 4")
plot_df %>% filter(ps_proj_eligible %in% ps_proj_list)
t <- plot_df %>% filter(ps_proj_eligible %in% ps_proj_list)
View(t)
shiny::runApp()
ts <- ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(source, recruit_date) %>%
count() %>%
group_by(source) %>%
mutate(rollavg = zoo::rollmean(n, 7, fill = NA),
cumsum = cumsum(n))
View(ts)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date))
View(ps_location)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(date, source) %>%
count()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source) %>%
count()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
select(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
group_by(recruit_date, source)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
select(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
group_by(recruit_date, source) %>%
count()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
mutate(cumulative = cumsum(n))
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
group_by(source) %>%
mutate(cumulative = cumsum(n))
t <- ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
group_by(source) %>%
mutate(cumulative = cumsum(n))
t %>%
tidyr::pivot_wider(
id_cols = -c(n, cumulative)
)
t %>%
tidyr::pivot_wider(
id_cols = -c(n, cumulative),
values_from = c(n, cumulative)
)
t %>%
tidyr::pivot_wider(
values_from = c(n, cumulative)
)
t %>%
tidyr::pivot_wider(
names_from = c(recruit_int_summ, randomized),
values_from = c(n, cumulative)
)
t %>%
tidyr::pivot_wider(
names_from = c(recruit_int_summ, randomized),
values_from = n
)
t %>%
tidyr::pivot_wider(
names_from = randomizec,
values_from = n
)
t %>%
tidyr::pivot_wider(
names_from = randomized,
values_from = n
)
t %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
t <- ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count()
t %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
ps_result <- t %>%
select(recruit_date, source, recruit_int_summ) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
ps_result <- t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
t <- ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungrouop()
ps_result <- t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
View(ps_result)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungrouop()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungrouop()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup()
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup() %>%
tidyr::fill(recuit_date, source, n)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup() %>%
tidyr::fill(recruit_date, source, n)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup()
t <- ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup()
ps_result <- t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
t %>%
select(recruit_date, source, recruit_int_summ, n)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup()
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
t %>%
select(recruit_date, source, recruit_int_summ, n)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
id_cols = c(recruit_date, source),
names_from = recruit_int_summ,
values_from = n
)
t %>%
select(recruit_date, source, recruit_int_summ, n)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
id_cols = recruit_date,
names_from = recruit_int_summ,
values_from = n
)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n
)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n,
values_fn = sum
)
t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n,
values_fill = 0,
values_fn = sum
)
ps_result <- t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n,
values_fill = 0,
values_fn = sum
)
t %>%
select(recurit_date, source, sl_status, n)
t %>%
select(recruit_date, source, sl_status, n)
t %>%
select(recruit_date, source, sl_status, n) %>%
tidyr::pivot_wider(
names_from = sl_status,
values_from = n,
values_fill = 0
)
t %>%
select(recruit_date, source, sl_status, n) %>%
tidyr::pivot_wider(
names_from = sl_status,
values_from = n,
values_fill = 0,
values_fn = sum
)
t %>%
select(recruit_date, source, sl_status, n) %>%
tidyr::drop_na(),
tidyr::pivot_wider(
names_from = sl_status,
values_from = n,
values_fill = 0,
values_fn = sum
)
t %>%
select(recruit_date, source, sl_status, n) %>%
tidyr::drop_na() %>%
tidyr::pivot_wider(
names_from = sl_status,
values_from = n,
values_fill = 0,
values_fn = sum
)
sl_status <- t %>%
select(recruit_date, source, sl_status, n) %>%
tidyr::drop_na() %>%
tidyr::pivot_wider(
names_from = sl_status,
values_from = n,
values_fill = 0,
values_fn = sum
)
t %>%
select(recruit_date, source, randomized, n)
t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized")
t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized, n = randomized)
t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized)
t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized, n = "randomized")
t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized)
t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized) %>%
rename("randomized" = n)
randomized <- t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized) %>%
rename("randomized" = n)
full_join(ps_result, sl_status)
test <-  full_join(ps_result, sl_status)
View(test)
tmp <- full_join(ps_result, sl_status)
full_join(tmp, randomized)
tab <- full_join(tmp, randomized)
View(tab)
t <- ps_location %>%
mutate(recruit_date = as.Date(recruit_date)) %>%
group_by(recruit_date, source, sl_status, recruit_int_summ, randomized) %>%
count() %>%
ungroup()
ps_result <- t %>%
select(recruit_date, source, recruit_int_summ, n) %>%
tidyr::drop_na() %>%
tidyr::pivot_wider(
names_from = recruit_int_summ,
values_from = n,
values_fill = 0,
values_fn = sum
)
sl_status <- t %>%
select(recruit_date, source, sl_status, n) %>%
tidyr::drop_na() %>%
tidyr::pivot_wider(
names_from = sl_status,
values_from = n,
values_fill = 0,
values_fn = sum
)
randomized <- t %>%
select(recruit_date, source, randomized, n) %>%
filter(randomized == "randomized") %>%
select(-randomized) %>%
rename("randomized" = n)
tmp <- full_join(ps_result, sl_status)
tab <- full_join(tmp, randomized)
View(tab)
View(ps_result)
View(sl_status)
tab %>%
group_by(month(recruit_date))
tab %>%
group_by(lubridate::month(recruit_date))
tab %>%
group_by(month = lubridate::month(recruit_date))
tab %>%
group_by(month = lubridate::month(recruit_date), source) %>%
summarize(across(.fns = sum, na.rm = TRUE))
tab %>%
group_by(month = lubridate::month(recruit_date), source) %>%
summarize(across(.cols = -c(recruit_date, source), .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = lubridate::month(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::yearmon(recruit_date), source) %>%
summarize(across(.cols = -c(recruit_date, month), .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -c(recruit_date, month), .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
write.csv("test_date.csv", row.names = FALSE)
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum/30 * 100, na.rm = TRUE))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(.fns, .x/30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(.fns = .x/30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(.fns = ./30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(~ . / 30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(everything(), ~ . / 30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(-month, ~ . / 30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(-source, ~ . / 30))
tab %>%
group_by(month = zoo::as.yearmon(recruit_date), source) %>%
summarize(across(.cols = -recruit_date, .fns = sum, na.rm = TRUE)) %>%
mutate(across(-source, ~ . / 4))
